# Next Phase Development Plan

## Raw Data Integration & Management System

### 背景・課題
- CivitAI APIのフィルタリングが不完全（他カテゴリのデータが混入）
- 現在は個別検索ごとに中間ファイルを生成
- 重複データの管理が非効率
- データの鮮度チェック機構が分散

### 提案する統合システム

#### 1. Raw Data統合管理
```
統合rawデータファイル構造:
- master_raw_data.jsonl: 全取得データの統合ファイル
- カテゴリ別インデックス: category_index.json
- 重複除去とマージ機能
```

#### 2. 重複管理機構
```python
# 重複検出・除去システム
- モデルIDベースの重複チェック
- バージョン情報の差分管理
- 古いデータの自動アーカイブ
```

#### 3. データ鮮度管理
```python
# 統合リフレッシュシステム
- 全データの最終更新チェック
- カテゴリ別の差分更新
- APIレート制限を考慮した効率的更新
```

#### 4. フィルタリング改善
```
- 統合データからの高精度フィルタリング
- カテゴリ混入データの自動検出・除去
- ユーザー定義フィルタルールの適用
```

### 実装優先度
1. **Phase 1**: 基本的な統合rawデータ管理
2. **Phase 2**: 重複除去・マージ機能
3. **Phase 3**: 自動リフレッシュ・差分更新
4. **Phase 4**: 高度なフィルタリング・データ品質管理

### 期待効果
- データ取得効率の向上
- ストレージ使用量の最適化
- フィルタリング精度の向上
- 定点観測システムの基盤構築

### 関連機能
- 定点的なNewestモデル取得
- カテゴリ横断検索
- データ品質分析・レポート機能

---

## 現在の中間ファイル改善（即時実装予定）

### 時間ベース管理
- デフォルト24時間キャッシュ
- `--max-age` オプションでの期限設定
- `--refresh` での強制更新

### 差分更新機能
- 新規データの自動検出
- 中間ファイルへの追記機能
- DBへの増分保存

### ユーザーオプション
```bash
--refresh          # 強制的に全データ再取得
--max-age 12h      # キャッシュ有効期限を設定
--skip-new-check   # 新規データチェックをスキップ
```